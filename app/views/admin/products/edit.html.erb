<h2>商品編集</h2>
<%= form_for @product,:url => {controller: "products", action: "update"} do |f| %>

  <img id="img_prev" width=320 height=180 src="#" class='hidden' />
  <%= attachment_image_tag @product, :image, fallback: "noimage.jpg", size:"320x180", class: 'default_img' %>

  <div class="attachment_field">
    <%= f.attachment_field :image, :id => 'post_img' %>
  </div>

  <div class="field">
      <%= f.label :商品名 %>
      <%= f.text_field :name %>
  </div>
  <div class="field">
      <%= f.label :商品説明 %>
      <%= f.text_area :explanation %>
  </div>
  <div class="field">
      <%= f.label :ジャンル %>
      <%= f.collection_select :genre_id, Genre.all, :id, :name, include_blank: "-- 選択して下さい --" %>
  </div>
  <div class="field">
      <%= f.label :税抜き価格 %>
      <%= f.text_field :price %>円
  </div>
  <div class="field">
      <%= f.label :販売ステータス %>
      <%= f.select :sale_status, [["販売中", "true"], ["売り切れ", "false"]], include_blank: "-- 選択して下さい --" %>
  </div>
  <div class="field">
      <%= f.submit "変更を保存", class: "btn btn-primary" %>
  </div>
  <% end %>

<%# ここから画像プレビュー機能(jquery) %>
<script>
  $( document ).on('turbolinks:load', function() {
    function readfile(input) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
          $('#img_prev').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
    $("#post_img").change(function(){
      $('#img_prev').removeClass('hidden');
      $('.default_img').remove();
      readfile(this);
    });
  });
</script>
<%# ここまで画像プレビュー機能(jquery) %>
